<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#363763" />
  <meta name="description" content="CR Attendance System - Offline-first attendance marking" />
  <title>CR Attendance ‚Äì COMSATS</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23363763' width='180' height='180'/><text x='50%' y='50%' font-size='80' fill='white' text-anchor='middle' dominant-baseline='middle' font-weight='bold'>CR</text></svg>">
  
  <style>
    :root {
      --cui-primary: #363763;
      --cui-primary-2: #1e1f4a;
      --cui-danger: #BD3850;
      --cui-success: #22c25f;
      --cui-warning: #ff9f40;
      --cui-bg: #f4f5f7;
      --cui-card: #ffffff;
      --cui-text: #1b1e28;
      --cui-muted: #6b7280;
      --cui-line: #e5e7eb;
      --cui-shadow: 0 10px 24px rgba(0,0,0,.10);
      --radius: 14px;
    }

    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: var(--cui-bg); color: var(--cui-text); }

    .app-container { min-height: 100vh; display: flex; flex-direction: column; }
    .topbar { background: linear-gradient(180deg, var(--cui-primary-2), var(--cui-primary)); color: #fff; padding: 14px 16px; flex-shrink: 0; box-shadow: 0 2px 8px rgba(0,0,0,.12); }
    .topbar-row { display: flex; justify-content: space-between; align-items: center; gap: 12px; }
    .brand { display: flex; flex-direction: column; gap: 2px; }
    .brand-h { font-weight: 700; font-size: 16px; letter-spacing: 0.2px; }
    .brand-s { opacity: 0.85; font-size: 12px; }

    .status-pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid rgba(255,255,255,.30); background: rgba(255,255,255,.10); white-space: nowrap; font-weight: 600; }
    .status-pill.online { border-color: rgba(34,194,107,.5); background: rgba(34,194,107,.15); color: var(--cui-success); }
    .status-pill.offline { border-color: rgba(255,159,64,.5); background: rgba(255,159,64,.15); color: var(--cui-warning); }

    .content { flex: 1; overflow-y: auto; padding: 12px 16px; display: flex; flex-direction: column; gap: 12px; }
    .card { border: 1px solid var(--cui-line); border-radius: var(--radius); padding: 12px; background: #fff; }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .card-title { font-weight: 800; font-size: 14px; }
    .card-badge { display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; }
    .badge-info { background: rgba(54,55,99,.15); color: var(--cui-primary); }
    .badge-warning { background: rgba(255,159,64,.15); color: var(--cui-warning); }
    .badge-success { background: rgba(34,194,107,.15); color: var(--cui-success); }

    .meta { display: grid; gap: 6px; font-size: 13px; }
    .meta-row { display: flex; gap: 12px; align-items: baseline; }
    .meta-label { min-width: 80px; color: var(--cui-muted); font-weight: 600; }
    .meta-value { font-weight: 700; flex: 1; }
    .meta-value.readonly { color: var(--cui-primary); }

    input[type="date"], input[type="time"], select, textarea { border: 1px solid var(--cui-line); border-radius: 8px; padding: 8px 10px; font-size: 13px; outline: none; font-family: inherit; }
    input[type="date"]:focus, input[type="time"]:focus, select:focus, textarea:focus { border-color: var(--cui-primary); box-shadow: 0 0 0 3px rgba(54,55,99,.12); }
    textarea { width: 100%; min-height: 80px; resize: vertical; }

    .checkbox-row { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
    .checkbox-row input { width: 18px; height: 18px; }
    .checkbox-row label { font-weight: 600; cursor: pointer; }

    .search-box { width: 100%; border: 1px solid var(--cui-line); border-radius: 8px; padding: 10px; font-size: 13px; outline: none; margin-bottom: 10px; }
    .search-box:focus { border-color: var(--cui-primary); box-shadow: 0 0 0 3px rgba(54,55,99,.12); }

    .button-group { display: flex; gap: 8px; flex-wrap: wrap; margin: 10px 0; }
    .btn { border: 1px solid var(--cui-line); background: #f8fafc; color: var(--cui-text); border-radius: 8px; padding: 8px 12px; font-size: 13px; cursor: pointer; transition: all 0.2s; font-weight: 600; }
    .btn:hover:not(:disabled) { background: #eef2f7; }
    .btn.primary { border-color: rgba(54,55,99,.25); background: rgba(54,55,99,.10); color: var(--cui-primary); }
    .btn.danger { border-color: rgba(189,56,80,.25); background: rgba(189,56,80,.08); color: var(--cui-danger); }
    .btn.success { border-color: rgba(34,194,107,.25); background: rgba(34,194,107,.08); color: var(--cui-success); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .student-list { margin-top: 10px; border-top: 1px solid var(--cui-line); }
    .student-row { display: grid; grid-template-columns: 34px 1fr 90px; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--cui-line); align-items: center; }
    .student-sr { text-align: center; color: var(--cui-muted); font-size: 12px; }
    .student-info { min-width: 0; }
    .student-reg { color: var(--cui-muted); font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .student-name { font-weight: 700; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .student-pa { display: flex; gap: 8px; justify-content: flex-end; }
    .pa-btn { width: 38px; height: 32px; border-radius: 8px; border: 1px solid var(--cui-line); display: flex; align-items: center; justify-content: center; font-weight: 800; cursor: pointer; user-select: none; background: #fff; transition: all 0.2s; font-size: 13px; }
    .pa-btn:hover { border-color: var(--cui-primary); }
    .pa-btn.active-p { border-color: rgba(34,194,107,.40); background: rgba(34,194,107,.15); color: var(--cui-success); }
    .pa-btn.active-a { border-color: rgba(189,56,80,.40); background: rgba(189,56,80,.15); color: var(--cui-danger); }

    .summary-pills { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; }
    .summary-pill { padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid var(--cui-line); background: #f8fafc; }

    .char-count { font-size: 12px; color: var(--cui-muted); margin-top: 6px; }

    .footer { padding: 12px 16px; background: #fff; border-top: 1px solid var(--cui-line); flex-shrink: 0; }
    .submit-btn { display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; border: none; border-radius: 10px; padding: 12px; background: linear-gradient(180deg, var(--cui-primary-2), var(--cui-primary)); color: #fff; font-weight: 800; font-size: 14px; cursor: pointer; transition: all 0.2s; letter-spacing: 0.5px; }
    .submit-btn:hover:not(:disabled) { filter: brightness(1.05); }
    .submit-btn:active:not(:disabled) { transform: translateY(1px); }
    .submit-btn:disabled { opacity: 0.55; cursor: not-allowed; }

    .footer-note { font-size: 12px; color: var(--cui-muted); margin-top: 8px; line-height: 1.4; }

    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,.5); display: flex; align-items: center; justify-content: center; padding: 16px; z-index: 1000; }
    .modal { background: #fff; border-radius: 12px; padding: 20px; max-width: 400px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,.3); }
    .modal-title { font-weight: 800; font-size: 16px; margin-bottom: 10px; }
    .modal-text { font-size: 14px; color: var(--cui-muted); line-height: 1.5; margin-bottom: 20px; }
    .modal-buttons { display: flex; gap: 10px; }
    .modal-buttons .btn { flex: 1; }

    .toast { position: fixed; bottom: 20px; right: 20px; background: #fff; border: 1px solid var(--cui-line); border-radius: 8px; padding: 12px 16px; box-shadow: 0 8px 24px rgba(0,0,0,.15); font-size: 13px; z-index: 999; animation: slideIn 0.3s ease-out; }
    .toast.success { border-left: 4px solid var(--cui-success); }
    .toast.error { border-left: 4px solid var(--cui-danger); }
    .toast.info { border-left: 4px solid var(--cui-primary); }

    @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    .hidden { display: none !important; }
    .locked-overlay { background: #f8fafc; opacity: 0.7; pointer-events: none; }

    @media (max-width: 480px) {
      .student-row { grid-template-columns: 30px 1fr 82px; }
      .pa-btn { width: 36px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- TOPBAR -->
    <div class="topbar">
      <div class="topbar-row">
        <div class="brand">
          <div class="brand-h">üì± CR Attendance</div>
          <div class="brand-s">Muhammad Jawad Rafeeq</div>
        </div>
        <div class="status-pill" id="statusPill">
          <span>üü¢</span>
          <span id="statusText">Online</span>
        </div>
      </div>
    </div>

    <!-- CONTENT -->
    <div class="content">
      <!-- SYNC STATUS -->
      <div class="card" id="syncCard" style="display: none;">
        <div class="card-header">
          <span class="card-title">‚ö†Ô∏è Sync Status</span>
        </div>
        <div id="syncMessage" style="font-size: 13px; color: var(--cui-muted);"></div>
      </div>

      <!-- COURSE INFO (READONLY) -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Course Information</span>
          <span class="card-badge badge-info">üìå Faculty-Set</span>
        </div>
        <div class="meta">
          <div class="meta-row">
            <span class="meta-label">Course</span>
            <span class="meta-value readonly" id="courseDisplay">‚Äî</span>
          </div>
          <div class="meta-row">
            <span class="meta-label">Section</span>
            <span class="meta-value readonly" id="sectionDisplay">‚Äî</span>
          </div>
          <div class="meta-row">
            <span class="meta-label">Students</span>
            <span class="meta-value readonly" id="studentCountDisplay">‚Äî</span>
          </div>
          <div class="meta-row">
            <span class="meta-label">Roster</span>
            <span class="meta-value readonly" id="rosterStatusDisplay" style="font-size: 12px;">‚Äî</span>
          </div>
        </div>
      </div>

      <!-- SESSION DETAILS (EDITABLE) -->
      <div class="card" id="sessionCard">
        <div class="card-header">
          <span class="card-title">Session Details</span>
          <span class="card-badge badge-info" id="editStatusBadge">‚úèÔ∏è Edit Mode</span>
        </div>
        <div class="meta">
          <div class="meta-row">
            <span class="meta-label">Date</span>
            <input type="date" id="dateInput" style="flex: 1; max-width: 200px;" />
          </div>
          <div class="meta-row">
            <span class="meta-label">Start Time</span>
            <input type="time" id="startTimeInput" style="flex: 1; max-width: 150px;" />
          </div>
          <div class="meta-row">
            <span class="meta-label">End Time</span>
            <input type="time" id="endTimeInput" style="flex: 1; max-width: 150px;" />
          </div>
          <div class="meta-row">
            <span class="meta-label">Type</span>
            <select id="classTypeInput" style="flex: 1; max-width: 200px;">
              <option value="1">Class</option>
              <option value="2">Lab</option>
              <option value="3">Exam</option>
            </select>
          </div>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" id="onlineCheckbox" />
          <label for="onlineCheckbox">Online Class</label>
        </div>
      </div>

      <!-- LECTURE NOTES -->
      <div class="card" id="notesCard">
        <div class="card-header">
          <span class="card-title">Lecture Notes</span>
        </div>
        <textarea id="notesInput" placeholder="Enter lecture notes (optional, max 2999 characters)" maxlength="2999"></textarea>
        <div class="char-count"><span id="charCount">0</span>/2999</div>
      </div>

      <!-- ATTENDANCE MARKING -->
      <div class="card" id="attendanceCard">
        <div class="card-header">
          <span class="card-title">Mark Attendance</span>
          <span class="summary-pills">
            Present: <strong id="presentCount">0</strong> ‚Ä¢ Absent: <strong id="absentCount">0</strong>
          </span>
        </div>
        <input type="text" class="search-box" id="studentSearch" placeholder="Search by name or registration number" />
        <div class="button-group">
          <button class="btn primary" id="markAllPresentBtn">‚úì Mark All Present</button>
          <button class="btn danger" id="markAllAbsentBtn">‚úó Mark All Absent</button>
          <button class="btn" id="resetBtn">‚Üª Reset</button>
        </div>
        <div class="student-list" id="studentList"></div>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <button class="submit-btn" id="submitBtn">
        <span>‚úì</span>
        <span>Submit & Lock</span>
      </button>
      <div class="footer-note">
        üí° Once submitted and locked, you cannot edit this attendance record. Make sure all marks are correct before submitting.
      </div>
    </div>
  </div>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW registration failed:', err));
    }
  </script>

  <!-- Main App Script -->
  <script src="./app.js"></script>
</body>
</html>
